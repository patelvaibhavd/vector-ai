# ===========================================
# Render Blueprint - Vector AI App
# Free Tier Compatible
# Docs: https://render.com/docs/blueprint-spec
# ===========================================

services:
  # ===========================================
  # Backend API (Node.js Express)
  # ===========================================
  - type: web
    name: vector-ai-backend
    runtime: node
    region: oregon
    plan: free
    branch: main
    rootDir: .
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /health

    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000

      # LLM (Groq)
      - key: LLM_PROVIDER
        value: groq
      - key: GROQ_CHAT_MODEL
        value: llama-3.1-8b-instant

      # Vector config
      - key: EMBEDDING_PROVIDER
        value: local
      - key: CHUNK_SIZE
        value: 300
      - key: CHUNK_OVERLAP
        value: 30
      - key: TOP_K_RESULTS
        value: 1
      - key: SIMILARITY_THRESHOLD
        value: 0.3
      - key: MAX_FILE_SIZE
        value: 5242880

  # ===========================================
  # Frontend (Angular Static Site)
  # ===========================================
  - type: static
    name: vector-ai-frontend
    branch: main
    rootDir: frontend
    buildCommand: npm install && npm run build:prod
    staticPublishPath: dist/vector-ai-frontend/browser

    headers:
      - path: /*
        name: Cache-Control
        value: public, max-age=31536000
      - path: /index.html
        name: Cache-Control
        value: no-cache

    routes:
      - type: rewrite
        source: /*
        destination: /index.html

    envVars:
      - key: NODE_VERSION
        value: 18
