# ===========================================
# Render Blueprint - Vector AI App
# Free Tier Compatible
# Docs: https://render.com/docs/blueprint-spec
# ===========================================

services:
  # ===========================================
  # Backend API Service (Node.js Express)
  # ===========================================
  - type: web
    name: vector-ai-backend
    runtime: node
    region: oregon                # ✅ Allowed for backend
    plan: free
    branch: main
    rootDir: .
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /health

    envVars:
      # ---------------------------------------
      # App Environment
      # ---------------------------------------
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000

      # ---------------------------------------
      # LLM Configuration (Groq)
      # ---------------------------------------
      - key: LLM_PROVIDER
        value: groq
      - key: GROQ_CHAT_MODEL
        value: llama-3.1-8b-instant

      # ---------------------------------------
      # Vector Search Configuration
      # ---------------------------------------
      - key: EMBEDDING_PROVIDER
        value: local
      - key: CHUNK_SIZE
        value: 300
      - key: CHUNK_OVERLAP
        value: 30
      - key: TOP_K_RESULTS
        value: 1
      - key: SIMILARITY_THRESHOLD
        value: 0.3
      - key: MAX_FILE_SIZE
        value: 5242880

      # ---------------------------------------
      # ❗ IMPORTANT
      # ---------------------------------------
      # DO NOT add GROQ_API_KEY here
      # Add it from Render Dashboard:
      # Backend → Environment → Add Variable
      #
      # Key:   GROQ_API_KEY
      # Value: your_real_key_here

  # ===========================================
  # Frontend Static Site (Angular)
  # ===========================================
  - type: web
    name: vector-ai-frontend
    runtime: static
    plan: free                     # ✅ Static free tier
    branch: main
    rootDir: frontend
    buildCommand: npm install && npm run build:prod
    staticPublishPath: dist/vector-ai-frontend/browser

    headers:
      - path: /*
        name: Cache-Control
        value: public, max-age=31536000
      - path: /index.html
        name: Cache-Control
        value: no-cache

    routes:
      - type: rewrite
        source: /*
        destination: /index.html

    envVars:
      - key: NODE_VERSION
        value: 18
